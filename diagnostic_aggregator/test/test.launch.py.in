"""
Launch the analyzer loader with parameters from yaml for testing.
"""

import launch
import launch.actions
import launch_ros.actions

import launch_testing
import launch_testing.util

import logging
import unittest

analyzer_params_filepath = "@ANALYZER_PARAMS_FILEPATH@"

logging.root.setLevel(logging.DEBUG)

aggregator = launch_ros.actions.Node(
    package ='diagnostic_aggregator',
    node_executable='aggregator_node',
    output='screen',
    parameters=[analyzer_params_filepath])

def generate_test_description(ready_fn):
        
    return launch.LaunchDescription([
        aggregator
    ])

@launch_testing.post_shutdown_test()
class TestProcessOutput(unittest.TestCase):

    def test_primary_analyzer_in_output(self):
        launch_testing.asserts.assertInStdout(
            self.proc_output,
            "/TEST/Primary",
            aggregator
        )

    def test_secondary_analyzer_in_output(self):
        launch_testing.asserts.assertInStdout(
            self.proc_output,
            "/TEST/Secondary",
            aggregator
        )
